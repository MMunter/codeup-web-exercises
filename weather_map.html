<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map Exercise</title>
    <style>
        .container{
            background-color: deepskyblue;
            width: 50%;
        }
        .singleDay{
            display: inline-block;
            margin-left: 50px;
            background-color: silver;
        }

        #map-canvas{
            width: 500px;
            height: 500px;
        }




    </style>
    <!--<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>-->
</head>
<body>
<div class="container">
    <h1>Weather Application</h1>

    <input id="lat" type="text" name="lat" placeholder="Enter latitude.">
    <input id="long" type="text" name="long" placeholder="Enter longitude.">

    <button id="coordinates" type="button">What's the weather?</button>

    <div id="weatherPanels"></div>
    <div id="map-canvas"></div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB7a53QJ5STa7Rtns_zN942EJkOuGcfHEU" type="text/javascript"></script>

<script>
    $(document).ready(function() {

        "use strict";

        var latLong = {
            "lat": 29.4241,
            "lon": -98.4936
        };



        function buildWeather() {
            latLong.lat = $("#lat").val();
            latLong.lon = $("#long").val();
            var weatherRequest = $.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
                APPID: "7f8e3aa0aad113510e0c1eaafd1c17b8",
                // q: "San Antonio, US",
                units: "imperial",
                lat: latLong.lat,
                lon: latLong.lon
        });

            weatherRequest.done(function (data) {
                var total = "";
                total += "<div>" + data.city.name + "</div>";
                for (var i = 0; i < 3; i += 1) {
                    total += "<div class='singleDay'>";
                    total += outputTemps(data.list[i]);
                    total += weatherIcon(data.list[i]);
                    total += showConditions(data.list[i]);
                    total += showHumidity(data.list[i]);
                    total += showPressure(data.list[i]);
                    total += showWind(data.list[i]);
                    total += "</div>";
                }
                $('#weatherPanels').html(total);

            });
            weatherRequest.fail(function (job, status) {
                console.log(status);
            });

            buildMap();

        }


        $("#coordinates").click(buildWeather);

        function outputTemps(forecastDay) {
            return "<div>" + Math.round(forecastDay.temp.max) + "℉" + "/" + Math.round(forecastDay.temp.min) + "℉" + "</div>";
        }

        function weatherIcon(icons) {
            return "<div><img class='icon' src='http://openweathermap.org/img/w/" + icons.weather[0].icon + ".png'>" + "</div>";
        }

        function showConditions(conditions){
              return"<div>" + conditions.weather[0].main + ": " + conditions.weather[0].description + "</div>";
        }

        function showHumidity(info) {
            return "<div>Humidity: " + info.humidity + "</div>";
        }

        function showPressure(info) {
            return "<div>Pressure: " + info.pressure + "</div>";
        }

        function showWind(info) {
            return "<div>Wind: " + info.speed + "</div>";
        }



        function buildMap() {

            var geocoder = new google.maps.Geocoder();

            var lat = $("#lat").val();
            var lon = $("#long").val();
            console.log("lat", lat);
            var latlon = new google.maps.LatLng(lat, lon);

            var mapOptions = {
                zoom: 13,
                center: latlon
            };

            var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
            geocoder.geocode({'latLng': latlon}, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    map.setCenter(results[0].geometry.location);
                }
                else {
                    alert("Geocoding was not successful - STATUS: " + status);
                }

            });
        }
    });
</script>








</body>
</html>